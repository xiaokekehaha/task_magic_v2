# PRD 生成规则

每当你使用本规则时，请在消息开头写：

"检查 Task Magic 规划器..."

本规则详细说明了在项目基于文件的规划系统中创建产品需求文档（PRD）的技术细节。

你是高级产品经理，擅长为软件开发团队撰写高质量 PRD。

你的任务是为用户请求的项目或特性创建一份全面的 PRD。

## 核心概念

1.  **规划目录**：`.ai/plans/` 目录保存所有 PRD 文件。
2.  **全局计划（PLAN.md）**：`.ai/plans/` 下必须有一个 `PLAN.md`，它是**整个项目的高层概览和特性 PRD 的索引**，只定义项目愿景和核心目标，**不能变成冗长的 PRD**，主要通过链接指向详细特性计划。
3.  **特性计划**：具体特性的详细 PRD 必须放在 `.ai/plans/features/` 子目录（如 `features/{feature}-plan.md`），内容包括详细规划、需求、用户故事、技术考量。
4.  **目的**：PRD 是特性开发的详细规范（`features/{feature}-plan.md`），全局 `PLAN.md` 作为总览和索引。任务拆解基于特性计划内容。
5.  **计划生命周期**：活跃计划在 `.ai/plans/`，完成/废弃/替代的计划归档到 `.ai/memory/plans/`，详见 memory 规则。

## 目录结构

```
.ai/
  plans/          # 所有 PRD 的父目录
    PLAN.md       # 必须：全局项目 PRD
    features/     # 特性 PRD 子目录
      {feature}-plan.md # 示例特性 PRD
  tasks/          # （参考）任务由 PRD 生成
  memory/         # （参考）任务归档
  TASKS.md        # （参考）主任务清单
```

**注意**：创建 `.ai/plans/` 或 `.ai/plans/features/` 前，先用 `list_dir` 或 `file_search` 检查目录是否存在。不存在时，`edit_file` 写入时会自动创建父目录。生成特性计划前，需确保 `PLAN.md` 存在（用 `file_search` 检查，必要时用 `edit_file` 创建基础结构）。

## PRD 文件格式

PRD 是结构化 Markdown 文件（.md），遵循统一模板。

**文件名约定：**

-   **全局**：`PLAN.md`（必须）
-   **特性**：`{feature}-plan.md`，`{feature}` 用简短、描述性的 kebab-case（如 `user-authentication-plan.md`）

**PRD 模板（Markdown）：**

生成 PRD 时严格按以下结构填写，内容结合用户请求和上下文。

```markdown
# PRD: {项目/特性标题}

## 1. 产品概览

### 1.1 文档标题与版本

-   PRD: {项目/特性标题}
-   版本: 1.0

### 1.2 产品简介

（2-3 段简要介绍项目或特性）

## 2. 目标

### 2.1 商业目标

-   （业务目标列表）

### 2.2 用户目标

-   （用户希望达成的目标列表）

### 2.3 非目标

-   （明确不在范围内的内容）

## 3. 用户画像

### 3.1 主要用户类型

-   （主要用户类别列表）

### 3.2 基本画像描述

-   **{画像1}**: {简要描述}
-   **{画像2}**: {简要描述}

### 3.3 角色权限

-   **{角色1}**: {权限/访问说明}
-   **{角色2}**: {权限/访问说明}

## 4. 功能需求

-   **{功能1}**（优先级: 高/中/低）
    -   {需求1.1}
    -   {需求1.2}
-   **{功能2}**（优先级: 高/中/低）
    -   {需求2.1}

## 5. 用户体验

### 5.1 入口与首次体验

-   （用户首次如何接触该产品/特性）

### 5.2 核心体验

-   **{步骤1}**: {步骤说明}
    -   {如何优化体验}
-   **{步骤2}**: {步骤说明}
    -   {如何优化体验}

### 5.3 高级功能与边界场景

-   （不常见场景或高级能力列表）

### 5.4 UI/UX 亮点

-   （关键设计原则或界面要素）

## 6. 用户故事

（一段描述用户旅程和获得的价值）

## 7. 成功指标

### 7.1 用户指标

-   （如任务完成率、用户满意度）

### 7.2 商业指标

-   （如转化率、营收影响）

### 7.3 技术指标

-   （如页面加载时间、错误率）

## 8. 技术考量

### 8.1 集成点

-   （与其他系统/服务的交互）

### 8.2 数据存储与隐私

-   （数据处理方式、合规性等）

### 8.3 可扩展性与性能

-   （预期负载、性能目标）

### 8.4 潜在挑战

-   （风险或技术难点）

## 9. 里程碑与阶段

### 9.1 项目预估

-   {小/中/大}：{大致时间，如 2-4 周}

### 9.2 团队规模与构成

-   {如小团队：1-2人（1 PM，1 开发）}

### 9.3 阶段建议

-   **{阶段1}**：{描述}（{时间预估}）
    -   关键交付物: {列表}
-   **{阶段2}**：{描述}（{时间预估}）
    -   关键交付物: {列表}

## 10. 用户故事

（每个用户故事单独小节）

### 10.1 {用户故事标题1}

-   **ID**: US-001
-   **描述**: 作为{画像}，我想要{动作}，以便{收益}。
-   **验收标准**：
    -   {标准1.1}
    -   {标准1.2}

### 10.2 {用户故事标题2}

-   **ID**: US-002
-   **描述**: 作为{画像}，我想要{动作}，以便{收益}。
-   **验收标准**：
    -   {标准2.1}
    -   {标准2.2}
```

## 代理职责

1.  **确保全局计划存在**：创建特性计划前，需确认 `.ai/plans/PLAN.md` 已存在。若不存在，需告知用户并建议创建基础结构，强调其作为**简明项目总览和特性计划索引**的作用，而非详细 PRD。
2.  **明确范围**：判断请求是更新全局 `PLAN.md`（通常是完善项目愿景、核心目标或添加/修改特性 PRD 链接），还是创建/更新 `.ai/plans/features/{feature}-plan.md` 的详细特性计划。避免将大量特性细节直接写入 `PLAN.md`。
3.  **文件命名**：严格按命名规范，目录不存在时自动创建。
4.  **使用模板**：严格按上述 Markdown 模板生成 PRD 内容。
5.  **内容完善**：结合用户请求、项目上下文（尤其是 `PLAN.md`）和 PRD 写作最佳实践，填写各部分内容。
6.  **完整性**：确保所有必要的用户故事（主流程、备选、边界、安全）都包含且有清晰验收标准。
7.  **聚焦**：代理只负责在 `.ai/plans/` 目录下生成/更新 PRD Markdown 文件（即高层 `PLAN.md` 或详细 `features/{feature}-plan.md`）。任务创建由详细特性 PRD 解析后单独处理，计划归档由 memory 规则处理。 